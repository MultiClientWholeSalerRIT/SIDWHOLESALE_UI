<div class="pagetitle">
  <h1>Live Rate</h1>
  <nav>
      <ol class="breadcrumb">
          <li class="breadcrumb-item">
              <a (click)="goto('/dashboard')" class="handPointer">Home</a>
          </li>
          <li class="breadcrumb-item active">Live Rate</li>
      </ol>
  </nav>
</div>

<!-- Inline Filter/Add Form -->
<div class="mb-3">
  <div>
    <form [formGroup]="rateForm" class="row g-2 align-items-end">
      <div class="col-md-3">
          <p-floatlabel variant="on">
              <p-datepicker
              [class.is-invalid]="rateForm.get('saleDate')?.touched && rateForm.get('saleDate')?.invalid"
                  formControlName="saleDate" 
                inputId="on_label"
                showIcon
                iconDisplay="input"
                dateFormat="dd.mm.yy"
              />
              <label for="on_label">Sales Date</label>
            </p-floatlabel>
        
        <div class="invalid-feedback" *ngIf="rateForm.get('saleDate')?.touched && rateForm.get('saleDate')?.errors?.['required']">
          Sale Date is required
        </div>
      </div>

      <div class="col-md-3">
        <label class="form-label">Rate</label>
        <input type="number" 
               class="form-control" 
               formControlName="rate" 
               step="0.01"
               min="0"
               [class.is-invalid]="rateForm.get('rate')?.touched && rateForm.get('rate')?.invalid">
        <div class="invalid-feedback" *ngIf="rateForm.get('rate')?.touched && rateForm.get('rate')?.errors?.['required']">
          Rate is required
        </div>
      </div>

      <div class="col-md-2">
        <button type="button" class="btn btn-primary w-100" (click)="saveRate()" [disabled]="!rateForm.valid">
          Save
        </button>
      </div>
    </form>
  </div>
</div>

<section class="section">
<div class="row">
  <div class="col-lg-12">
    <div>
      <div>
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Live Rate Information</h5>
          <div class="d-flex align-items-center gap-2">
            <input
              type="text"
              class="form-control"
              placeholder="Search..."
              (keyup)="onFilterTextBoxChanged($event)"
              style="width: 300px;"
            >
            <i 
              class="bi bi-file-earmark-excel fs-4 text-success"
              style="cursor: pointer;"
              (click)="exportToExcel()"
              title="Export to Excel">
            </i>
          </div>
        </div>

        <div>          
          <div class="ag-grid-wrapper">
            <ag-grid-angular
            style="width: 100%; height: calc(100vh - 200px)"
            class="ag-theme-alpine"
                [rowData]="rowData"
                [columnDefs]="colDefs"
                [domLayout]="'normal'"
                [suppressHorizontalScroll]="false"
                [defaultColDef]="{
                  flex: 1,
                  minWidth: 100,
                  resizable: true
                }"
                [pagination]="true"
                [paginationPageSize]="20"
                [quickFilterText]="searchText"
                (gridReady)="onGridReady($event)"
              >
            </ag-grid-angular>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
</section>
