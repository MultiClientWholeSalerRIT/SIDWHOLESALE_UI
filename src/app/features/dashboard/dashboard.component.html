<div class="pagetitle">
  <h1>Dashboard</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a (click)="goto('/dashboard')" class="handPointer">Home</a>
      </li>
      <li class="breadcrumb-item active">Dashboard</li>
    </ol>
  </nav>
</div>
<!-- End Page Title -->
<section class="section dashboard">
  <div class="row">
    <div class="col-lg-12">
      <div class="row">
      <div class="col">
        <div class="card info-card sales-card">

          <div class="card-body">
            <h5 class="card-title">Customers</h5>

            <div class="d-flex align-items-center">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                <i class="bi bi-person-fill"></i>
              </div>
              <div class="ps-3">
                <h6>{{dashBoardData()?.customerCount}}</h6>
                <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

              </div>
            </div>
          </div>

        </div>
      </div><!-- End Sales Card -->

      <!-- Revenue Card -->
      <div   *ngIf="isAdmin()" class="col">
        <div class="card info-card revenue-card">

          <div class="card-body">
            <h5 class="card-title">Vendors</h5>

            <div class="d-flex align-items-center">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                <i class="bi bi-people"></i>
              </div>
              <div class="ps-3">
                <h6 > {{dashBoardData()?.vendorCount}}</h6>
              </div>
            </div>
          </div>

        </div>
      </div><!-- End Revenue Card -->

      <!-- Customers Card -->
      <div class="col ">

        <div class="card info-card customers-card">

          <div class="card-body">
            <h5 class="card-title">Live Rate</h5>

            <div class="d-flex align-items-center">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                <i class="bi bi-broadcast"></i>
              </div>
              <div class="ps-3">
                <h6>â‚¹ {{dashBoardData()?.liveRate}}</h6>
              </div>
            </div>

          </div>
        </div>

      </div><!-- End Customers Card -->
      <div class="col" *ngIf="isAdmin()">

        <div class="card info-card customers-card">
          <div class="card-body">
            <h5 class="card-title">Total Sales</h5>

            <div class="d-flex align-items-center">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                <i class="bi bi-cart"></i>
              </div>
              <div class="ps-3">
                <h6 >{{dashBoardData()?.salesWeight}} KGs</h6>
              </div>
            </div>

          </div>
        </div>

      </div><!-- End Customers Card -->
    </div>
    <div class="row">
      <div 
        [ngClass]="isAdmin() ? 'col-lg-3' : 'col-6'" 
        class="mb-2">
        <h5>Sales Details</h5>
      </div>
      <div [ngClass]="isAdmin() ? 'col-lg-3' : 'col-lg-6'"
        class="d-flex justify-content-between align-items-right mb-2"
      >
        <!-- Right: Search + Excel Icon -->
        <div class="d-flex align-items-right gap-3">
          <input
            type="text"
            class="form-control"
            placeholder="Search..."
            (keyup)="onFilterTextBoxChanged($event)"
            style="width: 220px;"
          >
          <i 
            class="bi bi-file-earmark-excel fs-4 text-success"
            style="cursor: pointer; padding-bottom: 10px;"
            (click)="exportToExcel()"
            title="Export to Excel">
          </i>
        </div>
      </div>
      <div class="col-lg-6" *ngIf="isAdmin()">
        <h5>Daily Sales Graph</h5>
      </div>
    </div>
    <div class="row">
      <!-- Sales Table -->
      <div [ngClass]="isAdmin() ? 'col-lg-6' : 'col-12'" class="d-flex flex-column mb-2">
        <div class="ag-grid-wrapper flex-grow-1" style="height: 400px;">
          <ag-grid-angular
            style="width: 100%; height: 100%;"
            class="ag-theme-alpine"
            [rowData]="rowData()"
            [columnDefs]="colDefs"
            [domLayout]="'normal'"
            [suppressHorizontalScroll]="false"
            [defaultColDef]="{
              flex: 1,
              minWidth: 100,
              resizable: true
            }"
            [pagination]="true"
            [paginationPageSize]="100"
            [quickFilterText]="searchText()"
            (gridReady)="onGridReady($event)">
          </ag-grid-angular>
        </div>
      </div>

      <!-- Sales Graph -->
      <div class="col-lg-6 d-flex flex-column mb-2" *ngIf="isAdmin()">
        <div class="shadow-lg flex-grow-1" style="height: 400px;">
          <div class="p-3 h-100 d-flex align-items-center justify-content-center">
            <canvas id="dailySalesChart" style="width: 100%; height: 100%;"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12" style="height: 30px;">

      </div>
      
    </div>    
    <div class="row" *ngIf="isAdmin()">
      <div class="col-lg-3">
        <h5>Purchase Details</h5>
      </div>
      <div class="col-lg-3">
        
        <!-- Right: Search + Excel Icon -->
        <div class="d-flex align-items-center gap-3">
          <input
            type="text"
            class="form-control"
            placeholder="Search..."
            (keyup)="onFilterTextBoxChangedPurchase($event)"
            style="width: 220px;"
          >
          <i 
            class="bi bi-file-earmark-excel fs-4 text-success"
            style="cursor: pointer; padding-bottom: 10px;"
            (click)="exportToExcel()"
            title="Export to Excel">
          </i>
        </div>
      </div>
      <div class="col-lg-6">
        <h5>Daily Purchase Graph</h5>
      </div>
    </div>
    <div class="row" *ngIf="isAdmin()">
  <!-- Purchase Table -->
  <div class="col-lg-6 d-flex flex-column mb-2">
    <div class="ag-grid-wrapper flex-grow-1" style="height: 400px;">
      <ag-grid-angular
        style="width: 100%; height: 100%;"
        class="ag-theme-alpine"
        [rowData]="rowDataPurchase()"
        [columnDefs]="colDefsPurchase"
        [domLayout]="'normal'"
        [suppressHorizontalScroll]="false"
        [defaultColDef]="{
          flex: 1,
          minWidth: 100,
          resizable: true
        }"
        [pagination]="true"
        [paginationPageSize]="20"
        [quickFilterText]="searchTextPurchase()"
        (gridReady)="onGridReady($event)">
      </ag-grid-angular>
    </div>
  </div>

  <!-- Purchase Graph -->
  <div class="col-lg-6 d-flex flex-column mb-2">
    <div class="shadow-lg flex-grow-1" style="height: 400px;">
      <div class="p-3 h-100 d-flex align-items-center justify-content-center">
        <canvas id="dailyPurchaseChart" style="width: 100%; height: 100%;"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="row">
      <div class="col-lg-12" style="height: 30px;">

      </div>
      
    </div> 

  </div>
  </div>
</section>